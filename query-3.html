<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="180x180" href="/detective-sql/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/detective-sql/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/detective-sql/favicon-16x16.png">
    <link rel="manifest" href="/detective-sql/site.webmanifest">

    <link rel="stylesheet" href="styles/main.css">

    <script src="https://kit.fontawesome.com/9477a9faa7.js" crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.4/codemirror.min.js"
        integrity="sha512-M1DpFDDFHNgGdgVsSkTP1sjfWC7mQFJM3obQo8gyKHbZmbmr95Kl9wPYa5T70BFQBi0+/TlcG6IZDLowJCbKBQ=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.4/codemirror.min.css"
        integrity="sha512-xIf9AdJauwKIVtrVRZ0i4nHP61Ogx9fSRAkCLecmE2dL/U8ioWpDvFCAy4dcfecN72HHB9+7FfQj3aiO68aaaw=="
        crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.4/theme/nord.min.css"
        integrity="sha512-sPc4jmw78pt6HyMiyrEt3QgURcNRk091l3dZ9M309x4wM2QwnCI7bUtsLnnWXqwBMECE5YZTqV6qCDwmC2FMVA=="
        crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.4/mode/sql/sql.min.js"
        integrity="sha512-dfObApt1XdGl62IJLrjbIOc9QtnRORA5TCwdnJkSj6C/KjwMz2L/Sc4WlcrgAuWoY+n5xTf6NMMojoUOlgwjug=="
        crossorigin="anonymous"></script>

    <title>Unauthorised Transaction: The Baker's Error</title>
</head>

<body>
    <div class="hero-slim">
        <h1>Unauthorised Transaction: The Baker's Error</h1>
        <p>So, Stephen Pecan-Brownie seems to have messed up big time. It appears he has shipped out some bread with the
            mask used to commit the crime baked into it! Stephen knows that it was sent out in batch number
            <code>3269</code> and that he noticed it was missing after packing up some <code>sourdough</code> bread.
            Guess we better find out where it went!</p>
    </div>


    <style>
        .content-grid th:hover {
            cursor: default;
        }
    </style>

    <div class="content-grid">

        <div>
            <h2 class="center">Table Structure: <code>deliveries</code></h2>
            <div>
                <table class="structure">
                    <thead>
                        <tr>
                            <th>id <br><em>INTEGER</em></th>
                            <th>batch_no <br><em>VARCHAR(3)</em></th>
                            <th>bread_type <br><em>VARCHAR(30)</em></th>
                            <th>delivery_address <br><em>TEXT</em></th>
                        </tr>
                    </thead>
                    <tbody id="query-return">
                        <tr>
                            <td>&hellip;</td>
                            <td>&hellip;</td>
                            <td>&hellip;</td>
                            <td>&hellip;</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <style>
            #reload {
                font-size: 16px;
            }
        </style>
        <div class="query-region">
            <h2 class="center">Query Writer</h2>
            <div id="error" class="center"></div>
            <textarea id="code" rows="3"></textarea>
            <div class="center"><button onclick="runQuery()" class="center" id="run-button"><i
                        class="fas fa-database"></i> Run Query</button>
                <button id="reload"><i class="fas fa-sync-alt"></i> Reload DB</button></div>
        </div>
    </div>

    <div id="test"></div>

    <br>

    <script src="js/sql-wasm.js"></script>
    <script src="js/main.js"></script>
    <script>
        const exercise = new Exercise('bakery', "White jacket, chef's hat. Baker?", "customer_description",
            "narrative4.html");

        var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
            lineNumbers: true,
            mode: 'text/x-sql',
            smartIndent: true,
            indentWithTabs: true,
            lineWrapping: false,
            scrollbarStyle: "null",
            theme: 'nord',
            viewportMargin: Infinity
        });

        function run(query) {
            try {
                var stmt = database.exec(query);
                return stmt;
            } catch (err) {
                var error_div = document.getElementById("error");
                error_div.innerHTML = "";
                console.log(err.message);
                var error_info = document.createElement("p");
                error_info.innerText = err.message;
                error_div.appendChild(error_info);
                return false;
            }
        }

        function runQuery() {
            var query = editor.getValue();
            var result = run(query);
            if (result !== false) {
                showResults(document.getElementById('test'), result, query);
            }
        }
    </script>
    <script>
        getDatabase('bakery.db');
        var reload = document.getElementById('reload');
        reload.addEventListener('click', function () {
            reloadDB('bakery.db');
        });
    </script>

</body>

</html>